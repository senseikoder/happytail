---
import Layout from "../layouts/Layout.astro";
import Image from "astro/components/Image.astro";
import banner from "../images/banner-contact.webp";
---

<Layout title="Contact :: Happy Tail Grooming">
   <!-- Main -->
   <section id="main" class="container medium bg-wave">
      <header>
         <h2>Contact Us</h2>
         <!-- <p>Tell us what you think about our little operation.</p> -->
      </header>
      <div class="box">
         <span class="image featured"><Image src={banner} alt="FAQs" /></span>

         <div class="info">
            <div>
               <h4>Business Hours</h4>
               <ul class="alt">
                  <li>Mon - Tue - Wed: Closed</li>
                  <li>Thursday: 8:00 am - 5:00 pm</li>
                  <li>Friday: 8:00 am - 5:00 pm</li>
                  <li>Saturday: 8:00 am - 5:00 pm</li>
                  <li>Sunday: 9:00 am - 5:00 pm</li>
               </ul>
            </div>
            <div>
               <h4>Contact Details</h4>
               <ul class="iconos">
                  <li>
                     <i class="icon fa-solid fa-envelope"></i>
                     <a href="mailto:info@happytailgrooming.com"
                        >info@happytailgrooming.com</a
                     >
                  </li>
                  <li>
                     <i class="icon fa-solid fa-phone"></i>
                     <a href="tel:862-253-72-17">862-253-7217</a>
                  </li>
               </ul>
            </div>
         </div>

         <hr />

         <form id="contacto" method="post">
            <div class="row gtr-50 gtr-uniform">
               <div class="col-6 col-12-mobilep">
                  <input
                     type="text"
                     id="nameRokh4m"
                     value=""
                     placeholder="Name"
                  />
               </div>
               <div class="col-6 col-12-mobilep">
                  <input
                     type="text"
                     id="phoneRokh4m"
                     value=""
                     placeholder="Phone"
                  />
               </div>
               <div class="col-6 col-12-mobilep">
                  <input
                     type="text"
                     id="namePetRokh4m"
                     value=""
                     placeholder="Name of your pet"
                  />
               </div>
               <div class="col-6 col-12-mobilep">
                  <input
                     type="text"
                     id="breedRokh4m"
                     value=""
                     placeholder="Breed"
                  />
               </div>

               <div class="col-12">
                  <input
                     type="email"
                     id="emailRokh4m"
                     value=""
                     placeholder="Email"
                  />
               </div>

               <div class="col-6 col-12-narrower">
                  <label class="title">I prefer you contact me by: </label>
                  <input
                     type="checkbox"
                     id="contactEmail"
                     name="contact"
                     value="Email"
                  />
                  <label for="contactEmail">Email</label><br />
                  <input
                     type="checkbox"
                     id="contactPhone"
                     name="contact"
                     value="Phone"
                  />
                  <label for="contactPhone">Phone</label>
                  <input
                     type="checkbox"
                     id="contactText"
                     name="contact"
                     value="Text"
                  />
                  <label for="contactText"
                     >Text (using phone number above)</label
                  >
               </div>

               <div class="col-6 col-12-narrower">
                  <label class="title">How can we help? </label>

                  <input type="radio" name="help" value="Email" />
                  <input
                     type="radio"
                     id="helpAppointment"
                     name="help"
                     value="Appointment"
                  />
                  <label for="helpAppointment"
                     >I'd like to make an appointment</label
                  >
                  <input
                     type="radio"
                     id="helpServices"
                     name="help"
                     value="Services"
                  />
                  <label for="helpServices"
                     >I'd like to know more about your services</label
                  >
                  <input
                     type="radio"
                     id="helpContact"
                     name="help"
                     value="Contact"
                  />
                  <label for="helpContact">I'd just like to contact you</label>
               </div>

               <div class="col-12">
                  <textarea
                     id="messageRokh4m"
                     placeholder="Enter your message"
                     rows="4"></textarea>
               </div>

               <!-- T a r r i t o d e l i e m -->
               <div class="fieldset ohnohoney">
                  <label for="name"></label>
                  <input
                     autocomplete="off"
                     type="text"
                     id="name"
                     name="name"
                     placeholder="Your name here"
                  />
                  <label for="email"></label>
                  <input
                     autocomplete="off"
                     type="email"
                     id="nickname"
                     name="nickname"
                     placeholder="Your e-mail here"
                  />
               </div>

               <div class="col-12">
                  <div class="actions special align-center">
                     <input type="submit" value="Send Message" />
                  </div>
               </div>
            </div>
         </form>

         <div class="notification is-hidden align-center">
            <!-- <button class="delete"></button> -->
            <span class="text"></span>
         </div>
      </div>
   </section>

   <script>
      document.addEventListener("DOMContentLoaded", () => {
         const form = document.querySelector("#contacto");

         if (!form) return;

         const nombre = document.querySelector("#nameRokh4m");
         const telf = document.querySelector("#phoneRokh4m");
         const email = document.querySelector("#emailRokh4m");
         const nombremascota = document.querySelector("#namePetRokh4m");
         const razamascota = document.querySelector("#breedRokh4m");
         const mensaje = document.querySelector("#messageRokh4m");

         const contactEmail = document.querySelector("#contactEmail");
         const contactPhone = document.querySelector("#contactPhone");
         const contactText = document.querySelector("#contactText");

         const helpOptions = document.querySelectorAll("input[name='help']");

         const name = document.querySelector("#name");
         const nickname = document.querySelector("#nickname");
         const notif = document.querySelector(".notification");

         form.addEventListener("submit", async (event) => {
            event.preventDefault();
            if (!name.value && !nickname.value) {
               let contactMethods = [];
               if (contactEmail.checked) contactMethods.push("Email");
               if (contactPhone.checked) contactMethods.push("Phone");
               if (contactText.checked) contactMethods.push("Text");

               let helpOption = "";
               helpOptions.forEach((option) => {
                  if (option.checked) helpOption = option.value;
               });

               const cuerpo = `<h3>Contact Details</h3>
                           <p><b>Name:</b> ${nombre.value}</p>
                           <p><b>Contact Phone:</b> ${telf.value}</p>
                           <p><b>Email:</b> ${email.value}</p>
                           <p><b>Pet Name:</b> ${nombremascota.value}</p>
                           <p><b>Breed:</b> ${razamascota.value}</p>
                           <p><b>Preferred Contact Methods:</b> ${contactMethods.join(", ")}</p>
                           <p><b>How can we help:</b> ${helpOption}</p>
                           <p><b>Message:</b> ${mensaje.value}</p>
                           <br><br>
                           <p>This message was sent from happytailgrooming.com</p>`;

               const emailData = {
                  from: "web@happytailgrooming.com",
                  to: ["info@happytailgrooming.com"],
                  subject: "Contact Web Form",
                  html: cuerpo,
               };

               const res = await fetch("/api/sendEmail.json", {
                  method: "POST",
                  headers: {
                     "Content-Type": "application/json",
                  },
                  body: JSON.stringify(emailData),
               });

               if (res.ok) {
                  notif.classList.toggle("is-hidden");
                  notif.lastElementChild.innerHTML =
                     "Your message was sent! üëç<br>Please Allow up to 24 hours for a response";
               } else {
                  const error = await res.json();
                  console.error("Error:", error);
                  notif.lastElementChild.textContent =
                     "Oh sorry üôÅ, try again later";
                  notif.classList.toggle("is-hidden");
               }
            }

            setTimeout(() => {
               notif.classList.toggle("is-hidden");

               nombre.value = "";
               telf.value = "";
               email.value = "";
               nombremascota.value = "";
               razamascota.value = "";
               mensaje.value = "";
            }, 2000);
         });
      });
   </script>

   <style lang="scss">
      .image img {
         max-width: 100%;
         height: auto;
      }

      .iconos {
         list-style: none;
      }
      .icon {
         color: #56368a;
         margin-right: 1rem;
      }

      .info {
         display: flex;
         gap: 50px;
      }

      .title {
         font-weight: 500;
         font-size: large;
      }

      .ohnohoney {
         opacity: 0;
         position: absolute;
         top: 0;
         left: 0;
         height: 0;
         width: 0;
         z-index: -1;
      }

      @media (max-width: 768px) {
         .info {
            flex-direction: column;
         }
      }
   </style>
</Layout>
